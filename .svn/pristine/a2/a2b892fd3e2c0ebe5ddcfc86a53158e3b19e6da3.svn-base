<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.ddit.kixiv.notice.mapper.NoticeDao">
	
	<select id="noticeList" resultType="kr.ddit.kixiv.notice.vo.NoticeVO">
		select notice_id, notice_title, notice_content, hit, notice_sdate, admin_id
    	from(
        	select 
        	    notice_id, notice_title, notice_content, hit, notice_sdate, admin_id,
        	    row_number() over(order by notice_id desc) as rNum
        	from notice
        	<if test='searchType.equals("title")'>
        		WHERE notice_title like '%' || #{keyword} || '%'
        	</if>
        	<if test='searchType.equals("content")'>
        		WHERE notice_content like '%' || #{keyword} || '%'
        	</if>
        	<if test='searchType.equals("title_content")'>
        		WHERE notice_title like '%' || #{keyword} || '%'
		   		   OR notice_content like '%' || #{keyword} || '%'
        	</if>
    	)t
    	where rNum between #{startPost} and #{endPost}
        
	</select>
	
	<select id="totalCount" resultType="int">
		select count(*)
		from notice
		<if test='searchType.equals("title")'>
        		WHERE notice_title like '%' || #{keyword} || '%'
        	</if>
        	<if test='searchType.equals("content")'>
        		WHERE notice_content like '%' || #{keyword} || '%'
        	</if>
        	<if test='searchType.equals("title_content")'>
        		WHERE notice_title like '%' || #{keyword} || '%'
		   		   OR notice_content like '%' || #{keyword} || '%'
        	</if>
	</select>
	
	<update id="addHit">
		update notice
		set hit = (hit+1)
		where notice_id = #{notice_id}
	</update>
	
	<select id="getNotice" resultType="kr.ddit.kixiv.notice.vo.NoticeVO">
		select *
		from notice
		where notice_id = #{notice_id}
	</select>
	
	<insert id="write">
		insert into notice(NOTICE_ID, NOTICE_TITLE, NOTICE_CONTENT, HIT, NOTICE_SDATE, ADMIN_ID)
		values(
			(select max(notice_id) from notice)+1, 
			#{notice_title}, #{notice_content}, 0, sysdate, 'admin'
		)
	</insert>

	<update id="modify">
		update notice
		set notice_title = #{notice_title}, notice_content = #{notice_content}
		where notice_id = #{notice_id}
	</update>

	<delete id="delete">
		delete from notice
		where notice_id = #{notice_id}
	</delete>

	
</mapper>