<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.ddit.kixiv.user.mapper.UserDao">
	
	<select id="login" resultType="integer">
		SELECT COUNT(*)  from users
		where user_id=#{user_id} and password=#{password}
	</select>	
	
	<insert id="signup">
		INSERT INTO USERS(user_id, nickname, password, name, phone, zip, add1, add2, email, gelelry_yn, profile_img, join_date, sns_add, exit_yn, user_level)
		VALUES(
				#{user_id}, #{nickname}, #{password}, #{name}, #{phone}, #{zip}, #{add1}, #{add2}, #{email}, 
				'n', #{profile_img}, sysdate, #{sns_add}, 'n', #{user_level}
				)
	</insert>
	
	<select id="getUser" resultType="kr.ddit.kixiv.user.vo.User">
		select * from users
		where user_id=#{user_id}
	</select>

	<select id="getNickname" resultType="kr.ddit.kixiv.user.vo.User">
		select * from users
		where nickname=#{nickname}
	</select>
	
	<update id="proifleImgUpdate">
		update users
		set profile_img=#{profile_img}
		where user_id=#{user_id}
	</update>
	
	<update id="modify">
		update users
		set nickname=#{nickname}, 
	    password=#{password}, 
	    name=#{name},  
	    phone=#{phone}, 
	    zip=#{zip}, 
	    add1=#{add1}, 
	    add2=#{add2}, 
	    email=#{email}, 
	    sns_add=#{sns_add}
		where user_id=#{user_id}
	</update>
	
	
	<select id="emailCheck" resultType="int">
		select count(email) from users
		where email=#{email}	
	</select>
	
	<select id="totalCount" resultType="int">
	<![CDATA[
		select count(*)
		from users
		where user_level <> 'a'
	]]>
		<if test='searchType.equals("user_id")'>
       		AND user_id like '%' || #{keyword} || '%'
       	</if>
       	<if test='searchType.equals("nickname")'> 
       		AND nickname like '%' || #{keyword} || '%'
       	</if>
       	<if test='searchType.equals("id_nickname")'> 
       		AND (user_id like '%' || #{keyword} || '%'
	   		   OR nickname like '%' || #{keyword} || '%')
       	</if>
	</select>
	
	<select id="userList" resultType="kr.ddit.kixiv.user.vo.User">
		<![CDATA[
		select user_id, nickname, password, name, phone, zip, add1, add2, email, gelelry_yn, profile_img, join_date, sns_add, exit_yn, user_level
		from(
        	select 
        	    user_id, nickname, password, name, phone, zip, add1, add2, email, gelelry_yn, profile_img, join_date, sns_add, exit_yn, user_level,
        	    row_number() over(order by join_date desc) as rNum
        	from users
        	where user_level <> 'a' 
		]]>
         	<if test='searchType.equals("user_id")'>
         		AND user_id like '%' || #{keyword} || '%'
         	</if>
         	<if test='searchType.equals("nickname")'> 
         		AND nickname like '%' || #{keyword} || '%'
         	</if>
         	<if test='searchType.equals("id_nickname")'> 
         		AND (user_id like '%' || #{keyword} || '%'
 		   		   OR nickname like '%' || #{keyword} || '%')
         	</if>
    	)t
    	where rNum between #{startPost} and #{endPost}
	</select>
	
	<select id="findPwd" resultType="kr.ddit.kixiv.user.vo.User">
		select * from users
		where user_id=#{user_id}
		and email=#{email}
	</select>
	
	<update id="changeTempPwd">
		update users
		set password=#{password}
		where user_id=#{user_id}
	</update>
	
</mapper>