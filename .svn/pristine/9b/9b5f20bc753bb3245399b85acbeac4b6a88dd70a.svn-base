<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.ddit.kixiv.blackUser.mapper.BlackUserDao">
	
	<select id="blackList" resultType="kr.ddit.kixiv.blackUser.vo.BlackUserVO">
		select BLACK_NUM blackNum, BLACK_REASON blackReason, BLACK_DATE blackDate, USER_ID userId
		from(	
			select 
				BLACK_NUM,
                BLACK_REASON,
                BLACK_DATE,
                USER_ID,
                row_number() over(order by BLACK_NUM desc) as rNum
			from blackuser
			<if test="searchType.equals('id')">
				WHERE user_id like '%' || #{keyword} || '%'
			</if>
			<if test="searchType.equals('reason')">
				WHERE black_reason like '%' || #{keyword} || '%'
			</if>
			order by black_date desc
		)t
		where rNum between #{startPost} and #{endPost}
	</select>
	
	<select id="totalCount" resultType="int">
		select count(*)
		from blackuser
		<if test="searchType.equals('id')">
			WHERE user_id like '%' || #{keyword} || '%'
		</if>
		<if test="searchType.equals('reason')">
			WHERE black_reason like '%' || #{keyword} || '%'
		</if>
	</select>
	
	
	<delete id="delete">
		delete blackuser
		where user_id = #{userId}
	</delete>
	
	<update id="modify">
		update blackuser
		set black_reason = #{blackReason}
		where user_id = #{userId}
	</update>
	
		<insert id="blackAdd">
		INSERT INTO blackuser
		(BLACK_NUM, BLACK_REASON, BLACK_DATE, USER_ID)
		VALUES((select NVL(MAX(black_num),0) +1 from blackuser), #{blackReason}, sysdate, #{userId})
	</insert>
	
	<select id="blackCheck" resultType="kr.ddit.kixiv.blackUser.vo.BlackUserVO">
		select BLACK_NUM blackNum, 
				BLACK_REASON blackReason, 
				BLACK_DATE blackDate, 
				USER_ID userId 
        from blackuser
		where user_id=#{userId}
	</select>
	
	<delete id="checkValidUser">
		delete from blackuser
		where black_num in (
		    select black_num 
		    from
		    (
		        select black_num, black_date+30 endDay from blackuser
		    )
		    where sysdate > endDay
		)
	</delete>
		
	
	
</mapper>