<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<!DOCTYPE HTML>
<head>
	<title>KIXIV - 세상의 모든 사진</title>
	<meta charset="utf-8">
	  <meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
	<script src="http://code.jquery.com/ui/1.8.18/jquery-ui.min.js"></script>
	
	<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
	<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
		
	<!-- 서머노트를 위해 추가해야할 부분 -->
	<script src="/resources/summernote/summernote-lite.js"></script>
	<script src="/resources/summernote/lang/summernote-ko-KR.js"></script>
	<link rel="stylesheet" href="/resources/summernote/summernote-lite.css">
	<!--  -->
  
	<%@include file="include/option.jsp" %>
	
	<style>
		th {
			vertical-align: middle;
			text-align: center;
		}
		
		* {
		  box-sizing: border-box;
		}
		
		img {
		  vertical-align: middle;
		}
		
		/* Position the image container (needed to position the left and right arrows) */
		.container {
		  position: relative;
		}
		
  		/* Hide the images by default */
  		.mySlides {
  		  display: none;
  		}
		
		/* Add a pointer when hovering over the thumbnail images */
		.cursor {
		  cursor: pointer;
		}
		
		/* Next & previous buttons */
		.prev,
		.next {
		  cursor: pointer;
		  position: absolute;
		  top: 40%;
		  width: auto;
		  padding: 16px;
		  margin-top: -50px;
		  color: white;
		  font-weight: bold;
		  font-size: 20px;
		  border-radius: 0 3px 3px 0;
		  user-select: none;
		  -webkit-user-select: none;
		}
		
		/* Position the "next button" to the right */
		.next {
		  right: 0;
		  border-radius: 3px 0 0 3px;
		}
		
		/* On hover, add a black background color with a little bit see-through */
		.prev:hover,
		.next:hover {
		  background-color: rgba(0, 0, 0, 0.8);
		}
		
		/* Number text (1/3 etc) */
		.numbertext {
		  color: #f2f2f2;
		  font-size: 12px;
		  padding: 8px 12px;
		  position: absolute;
		  top: 0;
		}
		
		/* Container for image text */
		.caption-container {
		  text-align: center;
		  background-color: #222;
		  padding: 2px 16px;
		  color: white;
		}
		
		.row:after {
		  content: "";
		  display: table;
		  clear: both;
		}
		
		/* Six columns side by side */
		.column {
		  float: left;
		  width: 16.66%;
		}
		
		/* Add a transparency effect for thumnbail images */
		.demo {
		  opacity: 0.6;
		}
		
		.active,
		.demo:hover {
		  opacity: 1;
		}
		
	</style>
	
</head>

<body>
	<%@include file="include/header.jsp" %>

	<section class="container overflow-hidden py-5">
		<h1 class="text-dark h1" style="text-align:left;">펀딩글 작성</h1>
		<br/><br/>
		<!-- onsubmit="return validCheck();" -->
		<form method="post" enctype="multipart/form-data" >
			<div>
				<!-- 테이블 시작 -->
				<table class="table table-sm">
					<tbody>
						<tr>
							<th scope="col">펀딩기간</th>
							<td scope="col" style="padding:1px 15px;">
							<input type="text" name="sdate" id="fund_sdate" style="width: 200px; text-align: center;" placeholder="시작일 "/>
							~
							<input type="text" name="edate" id="fund_edate" style="width: 200px; text-align: center;" placeholder="마감일 "/>
							</td>
						</tr>
						<tr>
							<th scope="col">펀딩목표액</th>
							<td scope="col" style="padding:1px 15px;">
								<input type="text" name="achieve" id="achieve" style="width: 200px;" onkeyup="inputNumberFormat(this)" onkeypress="inNumber();" /> &nbsp;&nbsp;원
							</td>
						</tr>
						<tr>
							<th scope="col">1인당 펀딩금액</th>
							<td scope="col" style="padding:1px 15px;">
								<input type="text" name="one_price" id="one_price" style="width: 200px;" onkeyup="inputNumberFormat(this)" onkeypress="inNumber();" /> &nbsp;&nbsp;원
							</td>
						</tr>
						<tr>
							<th scope="col">펀딩종류</th>
							<td scope="col" style="padding:1px 15px;">
								<div style="display: block;">
									<c:forEach var="codeList" items="${codeList}">
										<div style="float:left; display: block; margin-top:4px;">
											<input type="radio" name="fundCode" id="${codeList.fund_code}" value="${codeList.fund_code}" style="margin-left: 20px;" /> ${codeList.code_name}
										</div>
									</c:forEach>
								</div>
							</td>
						</tr>
						
						<tr>
							<th scope="col">제목</th>
							<td scope="col" style="padding:1px 15px;"><input type="text" name="fund_title" id="title" style="width: 100%;"/></td>
						</tr>
						<tr>
							<th scope="col" style="width:150px; vertical-align: middle;">내용</th>
							<td scope="col">
								<div class="container">
								  <textarea class="summernote" name="fund_content"></textarea>    
								</div>
							</td>
						</tr>
						
						<tr>
							<th scope="col" style="width:150px; vertical-align: middle;">작가의사진</th>
							<td scope="col">
								<div class="container">
									<input type="file" id="fundImg" name="files" multiple="multiple" title="첨부파일" accept="image/*"/>
								</div>
								
								<div id="fundSlide" class="container">
								
								</div>
							</td>
						</tr>
						
					</tbody>				
				</table>
				<div class="d-grid justify-content-end">
				<input type="submit" class="btn btn-primary" value="작성"/>
				</div>
			</div>
			
		</form>
	</section>

	<%@include file="include/footer.jsp" %>

	<script>
	var sel_files = [];
	var slideIndex = 1;
	
	$(document).ready(function() {
		$('#fundImg').on("change", handleImgsFilesSelect);
	});
		
	function handleImgsFilesSelect(e) {
		var files = e.target.files;
		var filesArr = Array.prototype.slice.call(files);
		var length = filesArr.length;
		
		filesArr.forEach(function(f) {
			if(!f.type.match("image.*")) {
				alert("확장자는 이미지 확장자만 가능합니다.");
				return;
			}
			
			sel_files.push(f);
			
			var reader = new FileReader();
			reader.onload = function(e) {
				var img_html = 
				"<div name='mySlides' class='mySlides'>" +
				"	<img src=\'"+e.target.result+"\' style='width:100%; height:500px;'>" +
				"</div>";
				$('#fundSlide').append(img_html);
				showSlides(slideIndex);
			}
			reader.readAsDataURL(f);
		})
		
		$('#fundSlide').append(
			"<a class='prev' onclick='plusSlides(-1)'>＜</a>" + 
			"<a class='next' onclick='plusSlides(1)'>＞</a>"
		);
	}
	
	function plusSlides(n) {
	  showSlides(slideIndex += n);
	}
	
	function currentSlide(n) {
	  showSlides(slideIndex = n);
	}
	
	function showSlides(n) {
	  var i;
	  var slides = document.getElementsByClassName("mySlides");
	  if (n > slides.length) {slideIndex = 1}
	  if (n < 1) {slideIndex = slides.length}
	  
	  for (i = 0; i < slides.length; i++) {
	      slides[i].style.display = "none";
	  }
	 slides[slideIndex-1].style.display = "block";  
	}
	
	var toolbar = [
	    // 글자 크기 설정
	    ['fontsize', ['fontsize']],
	    // 굵기, 기울임꼴, 밑줄,취소 선, 서식지우기
	    ['style', ['bold', 'italic', 'underline','strikethrough', 'clear']],
	    // 글자색
	    ['color', ['forecolor','color']],
	    // 글머리 기호, 번호매기기, 문단정렬
	    ['para', ['ul', 'ol', 'paragraph']],
	    // 줄간격
	    ['height', ['height']],
	  ];

	var setting = {
	        height : 300,
	        minHeight : null,
	        maxHeight : null,
	        focus : true,
	        lang : 'ko-KR',
	        toolbar : toolbar
	};
	
	$('.summernote').summernote(setting);
	
// 	function validCheck(){
// 		var title = $.trim($("input[name=notice_title]").val());
		
// 		var content = $.trim($("textarea[name=notice_content]").val());
// 		if(title == ''){
// 			alert("title을 입력하세요");
// 			return false;
// 		}
// 		if(content == ''){
// 			alert("content를 입력하세요");
// 			return false;
// 		}
// 		return true;
// 	}

	$(function () {
         $("#fund_sdate, #fund_edate").datepicker();
     });
     
     $.datepicker.setDefaults({
         dateFormat: 'yy-mm-dd',
         prevText: '이전 달',
         nextText: '다음 달',
         monthNames: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
         monthNamesShort: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월', '9월', '10월', '11월', '12월'],
         dayNames: ['일', '월', '화', '수', '목', '금', '토'],
         dayNamesShort: ['일', '월', '화', '수', '목', '금', '토'],
         dayNamesMin: ['일', '월', '화', '수', '목', '금', '토'],
         showMonthAfterYear: true,
         yearSuffix: '년',
         minDate: "+7D",
     });
     
     function inputNumberFormat(obj) {
         obj.value = comma(uncomma(obj.value));
     }

     function comma(str) {
         str = String(str);
         return str.replace(/(\d)(?=(?:\d{3})+(?!\d))/g, '$1,');
     }

     function uncomma(str) {
         str = String(str);
         return str.replace(/[^\d]+/g, '');
     }
     
     function inNumber(){
         if(event.keyCode<48 || event.keyCode>57){
            event.returnValue=false;
         }
	}
     
    function goPopup(){
		var pop = window.open("/popup/jusoPopup.jsp","pop","width=570,height=420, scrollbars=yes, resizable=yes"); 
 	}

 	function jusoCallBack(roadFullAddr, addrDetail, zipNo){
		document.form.add1.value = roadFullAddr;
		document.form.add2.value = addrDetail;
		document.form.zip.value = zipNo;
 	}

	</script>
</body>
</html>