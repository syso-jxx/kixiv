<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.ddit.kixiv.likey.mapper.LikeyDao">

<!-- 좋아요 개수 확인 -->
	<select id="pictureSaveHeart" resultType="int">
	    SELECT COUNT(*)
	    FROM likey
	    WHERE pic_num = #{pic_num}
	</select>
	
	<!-- 좋아요 추가 -->
	<insert id="heartUp">
	    INSERT INTO likey (like_seq, user_id, pic_num)
	    VALUES (
	        (SELECT IFNULL(MAX(like_seq), 0) + 1 FROM likey),
	        #{user_id},
	        #{pic_num}
	    )
	</insert>
		
	<!-- 좋아요 삭제 -->
	<delete id="heartDown">
	    DELETE FROM likey
	    WHERE pic_num = #{pic_num} AND user_id = #{user_id}
	</delete>
		
	<!-- 특정 사진의 좋아요 리스트 확인 -->
	<select id="LikeyList" resultType="kr.ddit.kixiv.likey.vo.LikeyVo">
	    SELECT *
	    FROM likey
	    WHERE pic_num = #{pic_num} AND user_id = #{user_id}
	</select>
		
	<!-- 특정 사진의 모든 좋아요 삭제 -->
	<delete id="deleteLikey">
	    DELETE FROM likey
	    WHERE pic_num = #{pic_num}
	</delete>
	
	<!-- 특정 게시판에 속한 모든 사진의 좋아요 삭제 -->	
	<delete id="deleteLikeyB">
	    DELETE FROM likey
	    WHERE pic_num IN (
	        SELECT p.pic_num
	        FROM picture p
	        JOIN picboard b ON p.board_id = b.board_id
	        WHERE b.board_id = #{board_id}
	    )
	</delete>
</mapper>